const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./MandatoryCaptureModalDialog-B4BLy6T8.js","./main-Cz_EDjso.js","./analytics-C4g1w3Ww.js","./workers-0KObbvUQ.js","./main-D4fEuLpC.css","./MandatoryCaptureModalDialogContent-BGea4WAa.js","./MandatoryCaptureModalDialogContent-CIWfCS8i.css"])))=>i.map(i=>d[i]);
import{x as fe,y as xe,j as e,z as _e,R as x,A as pe,r as w,C as ve,H as Ce,l as $,E as Ie,a as h,F as K,G as k,I as M,e as g,J as A,K as W,L as ce,M as L,N as Be,O as be,P as je,Q as Se,T as z,U as Y,V as le,W as de,X as me,Y as we,Z as Pe,b as C,$ as v,a0 as ye,a1 as U,a2 as ze,a3 as ue,a4 as N,a5 as Q,a6 as Me,a7 as j,a8 as X,a9 as Fe,aa as He,ab as Ge,ac as Ne,ad as J,ae as $e,af as Le,ag as Te,ah as Ae,ai as ke,aj as We,ak as Re,al as Ve,am as qe,an as De,ao as Z,ap as Oe,aq as Ee,ar as Ye,as as Ue,at as Ke,au as Qe,av as Xe,aw as ee,_ as Je}from"./main-Cz_EDjso.js";import{Y as P}from"./analytics-C4g1w3Ww.js";import{S as Ze}from"./ScrollArea-D_4_3NIY.js";import{B as eo}from"./Background-CzE9_nId.js";import{u as oo}from"./MandatoryCaptureModalDialog.hooks-B2xtkTVY.js";import"./workers-0KObbvUQ.js";const he=fe((r,t)=>{const{w:o,h:s,miw:n,mih:i,...d}=xe("Space",null,r);return e.jsx(_e,{ref:t,...d,w:o,miw:n??o,h:s,mih:i??s})});he.displayName="@mantine/core/Space";const to="_gameInfoFrame_104t7_1",ro="_leftInfoFrame_104t7_9",so="_rightInfoFrame_104t7_17",ao="_gameFieldFrame_104t7_25",T={gameInfoFrame:to,leftInfoFrame:ro,rightInfoFrame:so,gameFieldFrame:ao},oe=44,te=500,no=320,io=r=>{const{left:t,field:o,right:s}=r,{ref:n,width:i,height:d}=pe(),l=w.useCallback((a,c)=>{const{w:m,h:_}=a,y=m<=1100?no:te;c.style.setProperty("--right-info-w",`${y}px`),c.style.setProperty("--field-max-w",`${m-oe-y}px`),c.style.setProperty("--field-max-h",`${_}px`)},[]);return w.useEffect(()=>{i&&d&&n.current&&l({w:i,h:d},n.current)},[i,d,n.current]),e.jsxs("div",{className:T.gameInfoFrame,ref:n,style:{"--left-info-w":`${oe}px`,"--right-info-w":`${te}px`},children:[e.jsx("div",{className:T.leftInfoFrame,style:{maxWidth:P?"var(--left-info-w, none)":"none"},children:t}),e.jsx("div",{className:T.gameFieldFrame,style:{width:P?"var(--field-max-w, none)":"none"},children:o}),e.jsx("div",{className:T.rightInfoFrame,style:{maxWidth:P?"var(--right-info-w, none)":"none"},children:s})]})},co=x.memo(io),lo="_leftInfoBox_1sk74_1",mo={leftInfoBox:lo},yo=r=>{const{settingsButton:t}=r,o=ve();return e.jsxs("div",{className:mo.leftInfoBox,children:[e.jsx(Ce,{id:$.root.button.openMainScreen,size:o.large||"2.25rem",iconSize:o.normal||"1.5rem"}),e.jsx("div",{}),t]})},uo=x.memo(yo),ho="_rightInfoBox_tr6ga_1",go="_gameInfoCard_tr6ga_10",fo="_history_tr6ga_29",V={rightInfoBox:ho,gameInfoCard:go,history:fo},re=({isTop:r=!1})=>{const t=Be(r);return e.jsx(e.Fragment,{children:t})},xo=r=>{const{GameHistory:t,externalContent:o,moveProgressBar:s,playerMaterial:n}=r,i=Ie(s,n),d=h(a=>a.app.gameType),l=h(a=>[K.InGame,K.AfterGame].includes(a.app.gameState)&&a.board.timeControl);return e.jsxs("div",{className:V.rightInfoBox,children:[l&&d!==k.Single&&e.jsx("div",{children:e.jsx(re,{isTop:!0})}),e.jsxs(M,{shadow:"sm",padding:L.isTV()?"xs":"lg",px:8,radius:"md",className:g(V.gameInfoCard),children:[!o&&e.jsxs(e.Fragment,{children:[d!==k.Single&&e.jsx(M.Section,{withBorder:!0,inheritPadding:!0,py:"xs",children:e.jsx(A,{children:i.topPlayerComponent})}),e.jsx(M.Section,{className:V.history,pl:12,children:e.jsx(t,{isShow:!0})}),e.jsx(M.Section,{withBorder:!0,inheritPadding:!0,py:"xs",children:e.jsx(A,{justify:"center",children:e.jsx(W,{direction:"column",w:"100%",align:"center",justify:"center",children:e.jsx(ce,{})})})}),e.jsx(M.Section,{withBorder:!0,inheritPadding:!0,py:"xs",children:e.jsx(A,{justify:"apart",align:"flex-start",children:i.botPlayerComponent})})]}),o]}),l&&e.jsx("div",{children:e.jsx(re,{})})]})},_o=x.memo(xo),po="_bottomInfoBox_1lrgc_1",vo={bottomInfoBox:po},Co=r=>{const{settingsButton:t,externalContent:o,playerMaterial:s,moveProgressBar:n}=r,i=be(n,s);return e.jsxs("div",{className:vo.bottomInfoBox,children:[!o&&e.jsxs(e.Fragment,{children:[i,e.jsx(ce,{settingsButton:t})]}),o]})},Io=x.memo(Co),Bo="_topInfoBox_1ge4u_1",bo="_topPlayerComponentBox_1ge4u_17",q={topInfoBox:Bo,"topInfoBox-single":"_topInfoBox-single_1ge4u_8",topPlayerComponentBox:bo},jo=r=>{const{GameHistory:t,externalContent:o,playerMaterial:s,moveProgressBar:n}=r,i=je(),d=h(m=>m.session.onlineIndicatorVisible),l=h(m=>m.config.aspectRatio),a=h(m=>m.app.gameType),c=Se(n,s);return e.jsxs("div",{className:g(q.topInfoBox,{[q["topInfoBox-single"]]:a===k.Single}),children:[!o&&e.jsxs(e.Fragment,{children:[l>.68&&d&&e.jsx(he,{h:26}),e.jsx(t,{isShow:i}),a!==k.Single&&e.jsx("div",{className:q.topPlayerComponentBox,children:c})]}),o]})},So=x.memo(jo),wo="_historyContainer_iguea_1",I={historyContainer:wo,"historyContainer-hidden":"_historyContainer-hidden_iguea_11","GameHistory-scroll":"_GameHistory-scroll_iguea_15","GameHistory-scrollbar":"_GameHistory-scrollbar_iguea_25","GameHistory-thumb":"_GameHistory-thumb_iguea_29","GameHistory-button":"_GameHistory-button_iguea_33","GameHistory-button-left":"_GameHistory-button-left_iguea_39","GameHistory-button-right":"_GameHistory-button-right_iguea_42"},Po=()=>{const r=Y(o=>o.board.leftHistoryButtonClick),t=h(o=>o.board.leftHistoryButtonClickPayload===null);return e.jsx(le,{id:"history-button-left",disabled:t,onClick:()=>r(),className:g(I["GameHistory-button"],I["GameHistory-button-left"]),variant:"outline",color:de.Secondary,children:e.jsx(me,{disabled:t,children:e.jsx(we,{})})})},zo=()=>{const r=Y(o=>o.board.rightHistoryButtonClick),t=h(o=>o.board.rightHistoryButtonClickPayload===null);return e.jsx(le,{id:"history-button-right",disabled:t,onClick:()=>r(),className:g(I["GameHistory-button"],I["GameHistory-button-right"]),variant:"outline",color:de.Secondary,children:e.jsx(me,{disabled:t,children:e.jsx(Pe,{})})})},Mo=x.memo(Po),Fo=x.memo(zo),Ho={scrollbar:I["GameHistory-scrollbar"],thumb:I["GameHistory-thumb"]},Go=r=>{var m,_;const{children:t,hidden:o=!1}=r,s=w.useRef(null),n=z(),i=Y(y=>y.canvas.setIsShowCanvas),d=h(y=>y.board.historyChangeTrigger),l=h(y=>y.board.history.length),a=h(y=>y.board.historyOffset),c=h(y=>y.analyze.isAnalyzeMode);return w.useEffect(()=>{var u;if(!s.current)return;const y=a??l;if(c||i(y===l),n){const p=s.current.querySelectorAll('[datatype="history-move-row"] > [datatype="history-move"]')[a??l-1]||{offsetLeft:0};s.current.scrollTo({left:p.offsetLeft-s.current.offsetWidth/2,behavior:"smooth"})}else{const f=s.current.scrollHeight/l,p=y-y%2,R=(((u=s.current.parentElement)==null?void 0:u.scrollHeight)||0)/2;s.current.scrollTo({top:f*p-R+15,behavior:"smooth"})}},[a,s.current,l,d,n,(m=s.current)==null?void 0:m.scrollWidth,(_=s.current)==null?void 0:_.scrollHeight,c]),e.jsxs("div",{className:g(I.historyContainer,{[I["historyContainer-hidden"]]:o}),datatype:"history-container",children:[n&&e.jsx(Mo,{}),e.jsx(Ze,{viewportRef:s,h:n?36:"100%",mih:n?void 0:30,w:"100%",className:I["GameHistory-scroll"],classNames:Ho,"aria-orientation":n?"horizontal":"vertical",children:t}),n&&e.jsx(Fo,{})]})},No=x.memo(Go),F={"FigureImg-figure":"_FigureImg-figure_n5vo3_1","FigureImg-figure-tv":"_FigureImg-figure-tv_n5vo3_7","FigureImg-figure-big":"_FigureImg-figure-big_n5vo3_16","FigureImg-figure-big-tv":"_FigureImg-figure-big-tv_n5vo3_22","FigureImg-figure-shadow":"_FigureImg-figure-shadow_n5vo3_36"},ge=({color:r,figure:t,big:o=!1})=>{const s=h(d=>d.config.figureTheme),i=h(d=>d.config.boardImageManager).getFigureImg({color:r,type:t,theme:s});return e.jsx(eo,{className:g(F["FigureImg-figure"],F["FigureImg-figure-shadow"],{[F["FigureImg-figure-big"]]:o,[F["FigureImg-figure-tv"]]:!o&&L.isTV(),[F["FigureImg-figure-big-tv"]]:o&&L.isTV()}),src:i})},$o="_HistoryMove_ur81p_1",H={HistoryMove:$o,"HistoryMove-content":"_HistoryMove-content_ur81p_19","HistoryMove-content-small":"_HistoryMove-content-small_ur81p_27","HistoryMove-dark":"_HistoryMove-dark_ur81p_61","HistoryMove-active-dark":"_HistoryMove-active-dark_ur81p_67"},Lo=r=>{var t;return e.jsxs(e.Fragment,{children:[((t=r.piece)==null?void 0:t.king)&&e.jsx(ge,{figure:ue.Queen,color:ze(r)}),r.to]})},To=r=>{const{id:t,move:o,offset:s,isSelected:n,isLast:i,onClick:d}=r,l=z(),a=v(u=>u.analyze.isAnalyzeMode),c=v(u=>{const f=o&&u.analyze.moveAnalyzeCache[o.after];return u.analyze.isAnalyzeMode&&f&&ye[f.type]||null},C),m=U(u=>u.canvas.setIsShowCanvas),_=a&&c?e.jsx(c.icon,{color:c.color,style:{marginLeft:4,opacity:c.opacity}}):i&&a&&l?e.jsx("div",{style:{width:"1em",height:"1em"}}):null,y=()=>{o&&(d({fen:o.after,offset:s}),a||m(i))};return e.jsx("div",{onClick:y,className:g({[H.HistoryMove]:o,[H["HistoryMove-dark"]]:o,[H["HistoryMove-active-dark"]]:n}),datatype:"history-move",children:e.jsxs("div",{id:t,className:g(H["HistoryMove-content"],{[H["HistoryMove-content-small"]]:L.isTV()}),children:[o?Lo(o):"",_]})},"white-move")},se=x.memo(To,C),Ao="_historyIndex_zsqwb_1",ko={historyIndex:Ao},Wo=r=>{const{i:t}=r,o=z();return o&&P&&t===1?null:e.jsx("div",{color:"gray",className:ko.historyIndex,style:{...!o&&{borderRight:"1px solid var(--mantine-color-secondary-6)"}},children:o&&P?"|":t},"index")},Ro=x.memo(Wo),Vo="_historyRow_hxxm7_1",qo={historyRow:Vo},Do=r=>r.board.history.reduce((t,o)=>{var s;return((s=t.at(-1))==null?void 0:s.length)===1?t.at(-1).push(o):t.push([o]),t},[]),Oo=()=>{const r=v(n=>n.board.history.length-1),t=v(n=>n.board.historyOffset??n.board.history.length-1),o=v(Do,C),s=U(n=>n.board.setMoveForView);return o.map((n,i)=>e.jsxs("div",{className:qo.historyRow,datatype:"history-move-row",children:[e.jsx(Ro,{i:i+1}),e.jsx(se,{id:`history-white-move-${i+1}`,onClick:s,move:n[0],offset:i*2,isSelected:t===i*2,isLast:i*2===r}),e.jsx(se,{id:`history-black-move-${i+1}`,onClick:s,move:n[1],offset:i*2+1,isSelected:t===i*2+1,isLast:i*2+1===r})]},i))},Eo=x.memo(Oo),ae={"GameHistory-container":"_GameHistory-container_17lzv_1"},Yo=r=>{const{isShow:t=!0}=r,o=z();return e.jsx(A,{className:ae["GameHistory-container"],children:e.jsx(No,{hidden:!t,children:e.jsx(W,{direction:o?"row":"column",h:o?"100%":void 0,wrap:"nowrap",className:ae["GameHistory-history"],children:t&&e.jsx(Eo,{})})})})},ne=x.memo(Yo),Uo="_PlayerMaterial_14t8l_2",G={PlayerMaterial:Uo,"PlayerMaterial--figures":"_PlayerMaterial--figures_14t8l_11","PlayerMaterial--figures-small":"_PlayerMaterial--figures-small_14t8l_21","PlayerMaterial--figures-stack":"_PlayerMaterial--figures-stack_14t8l_24"},Ko=({color:r})=>{const t=v(l=>l.config.displayScoreDifference),o=r===N.White?N.Black:N.White,s=t?r:o,{materialInPawnsDelta:n,figures:i,hasCaptures:d}=v(l=>{const a=l.config.displayScoreDifference?l.board.boardMaterialInPawns.differenceCapturedFigures[r]:l.board.boardMaterialInPawns.allCapturedFigures[r];return{materialInPawnsDelta:a.delta,hasCaptures:l.board.boardMaterialInPawns.allCapturedFigures.w.hasCaptures||l.board.boardMaterialInPawns.allCapturedFigures.b.hasCaptures,figures:Q.slice(1,Q.length).split("").filter(c=>a[c]>0).map(c=>({char:c,cnt:a[c]}))}},C);return e.jsx(W,{className:g(G.PlayerMaterial),wrap:"nowrap",w:"100%",justify:"space-between",align:"center",children:e.jsx(Me,{color:r,hasCaptures:d,children:e.jsxs(W,{align:"center",mih:32,className:g(G["PlayerMaterial--figures"],{[G["PlayerMaterial--figures-small"]]:L.isTV()}),id:`${r}-player-score`,children:[i.map(l=>e.jsx("div",{className:g(G["PlayerMaterial--figures-stack"]),id:`${s}-${l.char}-${l.cnt}`,children:new Array(l.cnt).fill(0).map((a,c)=>e.jsx(ge,{color:s,figure:l.char,big:!0},c))},l.char)),n>0&&t&&e.jsxs("div",{className:G["PlayerMaterial--figures-delta"],children:["+",n]})]})})})},Qo=r=>{const{currBoard:t,prevBoard:o,captures:s}=r,n=[];for(let i=0;i<t.length;i++){const d=t[i],l=o[i];for(let a=0;a<t[i].length;a++){const c=d[a],m=l[a];C(c,m)||n.push({currCell:c,prevCell:m,rowIndex:i,cellIndex:a,type:!c&&m&&s.includes(m.square)?j.Taking:!c&&m?j.Leaving:j.Promotion})}}return n},Xo=r=>{const{currBoard:t,changedCells:o}=r,s={[N.Black]:{},[N.White]:{}},n=o.filter(a=>{var c;return!!((c=a==null?void 0:a.prevCell)!=null&&c.type)}),i=(a,c)=>{var _,y,u;const m=j.Leaving;if((c==null?void 0:c.type)===ue.Pawn){const f=n.filter(({prevCell:p,type:R})=>R===m&&X(p,c)&&!s[c.color][(p==null?void 0:p.square)||""]);if(f.length>0){const p=Fe(c,f);if(p!=null&&p.prevCell&&(s[c.color][p.prevCell.square]=!0,p.prevCell))return p.prevCell}}return((_=n.find(({prevCell:f})=>X(f,c)))==null?void 0:_.prevCell)||((y=a.find(({type:f})=>f===m))==null?void 0:y.prevCell)||((u=a.find(({type:f})=>f===j.Taking))==null?void 0:u.prevCell)||c},d=t.map(a=>[...a]);return o.filter(a=>[j.Taking,j.Promotion].includes(a.type)).forEach(a=>{var _;const c=i(o,a.currCell),m={...d[a.rowIndex][a.cellIndex],...a.type===j.Taking?{...a.prevCell,cellBefore:a.prevCell}:{},...(_=a.currCell)!=null&&_.square&&(c!=null&&c.square)?{move:{to:a.currCell.square,from:c==null?void 0:c.square}}:{}};d[a.rowIndex][a.cellIndex]=Object.keys(m).length>0?m:null}),d},Jo=He.mapNaN,D=(r,t,o)=>{const[s,n]=t,[i,d]=o,l=n-s,a=d-i;if(l===0)return i;const c=(r-s)/l;return i+c*a},Zo=(r,t,o)=>{r=Jo(r,0);for(let s=0;s<t.length-1;s++){const n=t[s],i=t[s+1],d=o[s],l=o[s+1];if(r>=n&&r<=i)return D(r,[n,i],[d,l])}return r<t[0]?D(r,[t[0],t[1]],[o[0],o[1]]):D(r,[t[t.length-2],t[t.length-1]],[o[o.length-2],o[o.length-1]])},et="_xCoord_10v1q_39",ot="_xCoordRotated_10v1q_47",tt="_yCoord_10v1q_51",rt="_yCoordRotated_10v1q_59",B={"axes-yCoords":"_axes-yCoords_10v1q_1","axes-yCoords__rotated":"_axes-yCoords__rotated_10v1q_12","axes-xCoords":"_axes-xCoords_10v1q_16","axes-xCoords__rotated":"_axes-xCoords__rotated_10v1q_26",xCoord:et,xCoordRotated:ot,yCoord:tt,yCoordRotated:rt},st=({isBoardFlipped:r})=>{const t=h(s=>Ge(s.config.boardTheme).colors,C),o=h(s=>Zo(s.config.boardFading,[-.35,0,.35],[.65,1,1.25]),C);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:g(B["axes-xCoords"],{[B["axes-xCoords__rotated"]]:r}),style:{filter:`brightness(${o})`},children:Ne.map(s=>{const n=J(`${s}2`),i=t[n.color];return e.jsx("div",{className:g(B.xCoord,{[B.xCoordRotated]:r}),...i&&{style:{color:i}},children:s},s)})}),e.jsx("div",{className:g(B["axes-yCoords"],{[B["axes-yCoords__rotated"]]:r}),style:{filter:`brightness(${o})`},children:$e.map(s=>{const n=J(`g${s}`),i=t[n.color];return e.jsx("div",{className:g(B.yCoord,{[B.yCoordRotated]:r}),...i&&{style:{color:i}},children:s},s)})})]})},at=x.memo(st),nt="_BoardIconsOverlay_10lcx_1",it="_analyzeIcon_10lcx_11",ct="_analyzeIconRotated_10lcx_16",lt="_analyzeIconSVG_10lcx_19",dt="_analyzeIconSVGRightBorder_10lcx_27",mt="_analyzeIconSVGTopBorder_10lcx_31",yt="_analyzeIconShadow_10lcx_35",ut="_analyzeIconLoader_10lcx_38",b={BoardIconsOverlay:nt,analyzeIcon:it,analyzeIconRotated:ct,analyzeIconSVG:lt,analyzeIconSVGRightBorder:dt,analyzeIconSVGTopBorder:mt,analyzeIconShadow:yt,analyzeIconLoader:ut},ht=()=>{const{isAnalyticsProgress:r,isAnalyzeMode:t,moveAnalyzeDetailsType:o,lastMoveTo:s,rotated:n}=h(u=>{var f,p;return u.analyze.isAnalyzeMode?{isAnalyticsProgress:u.analyze.isAnalyticsProgress,isAnalyzeMode:u.analyze.isAnalyzeMode,moveAnalyzeDetailsType:(f=u.analyze.moveAnalyzeDetails)==null?void 0:f.type,rotated:u.board.isRotated,lastMoveTo:(p=u.board.lastMove)==null?void 0:p.to}:{isAnalyzeMode:!1}},C),[i,d]=Le();if(!s||!t)return null;const l=ye[o],[a,c]=Te(s),[m,_]=[a,c].map(u=>(u-1)*100/8),y=g(b.analyzeIconSVG,{[b.analyzeIconSVGRightBorder]:n?a===1:a===8,[b.analyzeIconSVGTopBorder]:n?c===1:c===8});return e.jsx("div",{className:b.BoardIconsOverlay,children:t&&e.jsx("div",{ref:i,className:g(b.analyzeIcon,{[b.analyzeIconRotated]:n}),style:{left:`${m}%`,bottom:`${_}%`},children:!r&&l?e.jsx(l.icon,{className:g(y),wrapperClassName:b.analyzeIconShadow,size:"30%",color:l.color,style:{marginLeft:4,opacity:l.opacity}}):e.jsx(Ae,{className:b.analyzeIconLoader,size:d.width,strokeWidth:7,isInfinity:!0,tickSize:25,unActiveStrokeColor:"transparent",activeStrokeColor:"rgba(0,0,0,0.2)"})},"analyze-icon")})},gt=x.memo(ht),ft="_scoreLineContainerVertical_7f96d_1",xt="_scoreLineWhiteGauge_7f96d_14",_t="_scoreLineScore_7f96d_22",O={scoreLineContainerVertical:ft,scoreLineWhiteGauge:xt,scoreLineScore:_t},pt=()=>{const r=h(a=>({normalizedScore:a.analyze.moveAnalyzeDetails.normalizedScore}),C),t=h(a=>ke(a.config.figureTheme)??We),o=h(a=>a.board.isRotated),{normalizedScore:s}=r,n=Re(r),{score:i}=Ve(s),d=n>50,l=(()=>{if(!o&&!d)return{bottom:"100%",color:t.contentBlack};if(!o&&d)return{bottom:"100%",transform:"translateY(100%)",color:t.contentWhite};if(o&&!d)return{top:"100%",color:t.contentBlack};if(o&&d)return{top:"100%",transform:"translateY(-100%)",color:t.contentWhite}})();return e.jsx("div",{className:O.scoreLineContainerVertical,style:{backgroundColor:t.bgBlack,color:t.contentBlack,justifyContent:"end",flexDirection:"column-reverse",...o&&{justifyContent:"start",flexDirection:"column"}},children:e.jsx("div",{className:O.scoreLineWhiteGauge,style:{height:`${n}%`,backgroundColor:t.bgWhite},children:e.jsx("div",{className:O.scoreLineScore,style:l,children:i||"..."})})})},vt=x.memo(pt),Ct="_boardWrapperContainer_cx8xu_1",It="_boardWrapperContainerWithAnalyze_cx8xu_14",Bt="_chessScoreLineBox_cx8xu_21",bt="_boardOrientationBox_cx8xu_27",jt="_boardOrientationBoxRotated_cx8xu_37",St="_chessBoardBox_cx8xu_41",wt="_chessCellsBox_cx8xu_47",S={boardWrapperContainer:Ct,boardWrapperContainerWithAnalyze:It,chessScoreLineBox:Bt,boardOrientationBox:bt,boardOrientationBoxRotated:jt,chessBoardBox:St,chessCellsBox:wt},Pt=r=>{const{children:t}=r,o=h(d=>d.board.isRotated),s=h(d=>d.analyze.isAnalyzeMode),n=z(),i=s&&!n;return P?t:e.jsxs("div",{className:g(S.boardWrapperContainer,{[S.boardWrapperContainerWithAnalyze]:i}),children:[i&&e.jsx("div",{className:S.chessScoreLineBox,children:e.jsx(vt,{})},"chess-score-line-box"),e.jsx("div",{id:$.gameBoard.boardOrientationBox,className:g(S.boardOrientationBox,{[S.boardOrientationBoxRotated]:o}),children:e.jsxs("div",{className:S.chessBoardBox,children:[e.jsx("div",{className:S.chessCellsBox,children:t}),e.jsx(qe,{}),e.jsx(gt,{}),e.jsx(at,{isBoardFlipped:o})]})},"board-orientation-box")]})},zt=x.memo(Pt),Mt=()=>{const r=v(t=>t.flags.isScreenshotTest?t.board.currGameEngine.fen():void 0);return e.jsx("div",{style:{display:"none"},id:$.gameBoard.chessFen,children:r})},Ft=r=>({board:r.board(),fen:r.fen()}),Ht=()=>{const r=U(l=>l.board.playerTryMove),t=v(l=>{var a;return((a=l.board.lastMove)==null?void 0:a.captures)??De},C),o=v(l=>Ft(l.board.currGameEngine),Z),s=v(l=>l.board.prevGameBoard,Z),[n,i]=w.useMemo(()=>{const l=Qo({currBoard:o.board,prevBoard:s.board,captures:t}),a=Xo({currBoard:o.board,changedCells:l}),c=a.flatMap(m=>m).find(m=>m==null?void 0:m.move);return[a,c]},[o,s,t]),d=w.useMemo(()=>n.map((l,a)=>l.map((c,m)=>{const _=Ue(m,a),y=Oe(_),u=Ee(c),f=Ye(_,c,i);return{square:_,color:y,figure:u,prevFigure:f}})),[n,i]);return e.jsxs(zt,{children:[e.jsx(Mt,{}),e.jsx(Ke,{board:d,playerTryMove:r})]})},ie=x.memo(Ht),Gt=x.lazy(()=>Je(()=>import("./MandatoryCaptureModalDialog-B4BLy6T8.js"),__vite__mapDeps([0,1,2,3,4,5,6]),import.meta.url)),E=r=>e.jsx(Ko,{color:r}),Nt=()=>{const r=oo(Qe.GameDialog),t=v(n=>n.modals.isShowMandatoryCaptureDialog),o=(()=>{if(t)return e.jsx(w.Suspense,{children:e.jsx(Gt,{setMandatoryCapture:r})})})(),s=z();return e.jsxs(e.Fragment,{children:[s&&e.jsx(Xe,{top:e.jsx(So,{moveProgressBar:null,playerMaterial:E,GameHistory:ne}),field:e.jsx(ie,{}),bottom:e.jsx(Io,{moveProgressBar:null,playerMaterial:E,settingsButton:e.jsx(ee,{id:$.gameInfo.gameControlButton.button.settings}),externalContent:o})}),!s&&e.jsx(co,{left:e.jsx(uo,{settingsButton:e.jsx(ee,{id:$.gameInfo.gameControlButton.button.settings})}),field:e.jsx(ie,{}),right:e.jsx(_o,{moveProgressBar:null,playerMaterial:E,GameHistory:ne,externalContent:o})})]})},Rt=x.memo(Nt);export{Rt as default};
