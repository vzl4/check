import{aQ as v,a as r,cs as G,r as f,d2 as b,ay as p,j as e,d3 as E,cr as j,F as A,J as y,K as g,aC as C,b as M,U as h,bi as F,co as P,ct as R,M as k,aD as z,cc as B,bZ as I,bj as N,bo as T,bp as w,l as x,bF as D,R as _,aG as H,aH as L,T as V}from"./main-Cz_EDjso.js";import{M as U}from"./ModalExternal-Bc4p8-uQ.js";import{Q}from"./analytics-C4g1w3Ww.js";import{S as q}from"./Switch-kkRJNaF4.js";import{G as J}from"./GameSettings-BjRaJEZ_.js";import{d as K}from"./debounce-Duy6lWxL.js";import"./workers-0KObbvUQ.js";import"./ScrollArea-D_4_3NIY.js";import"./Background-CzE9_nId.js";import"./RewardPaymentEl-DJaO0Moh.js";import"./PremiumModal-BNGw1tw5.js";import"./PremiumTime-DnpUiTt6.js";const W=c=>{const{isSearchStarted:s}=c,l=v(),t=r(a=>a.app.gameState),d=r(a=>a.app.gameType),i=r(a=>a.online.onlineState),S=G(),u=r(a=>a.flags.isScreenshotTest),n=f.useMemo(()=>{let a;return i===b.ACTIVE_SEARCH_CONNECTING?a=p("connectingToTheServer"):S?a=p("connectionToOpponent"):a=p("searchForAnOpponent"),{title:a,icon:e.jsx(E,{width:20,height:20,isAnimate:!u})}},[i,S,l]);return!s||[j.Online,j.TogetherOnline,j.FakeOnline].includes(d)&&t===A.InGame?null:e.jsx(y,{justify:"center",children:e.jsxs(g,{direction:"row",align:"center",gap:4,children:[e.jsx(C,{component:"div",size:"md",children:n.title}),n.icon]})})},Y=c=>{const{isSearchStarted:s}=c,l=r(n=>n.platform.player,M),t=r(n=>n.p2p.player,M),d=h(n=>n.platform.setPlayer),i=h(n=>n.config.setOnlineName),S=F();r(n=>n.flags.isScreenshotTest),f.useCallback(n=>{if(!l)throw new Error("platform player is absent");i(n),d({...l,name:n})},[l,i,d]);const u=P(t,!1);return e.jsxs(g,{ml:4,pt:"xs",justify:"center",align:"center",children:[e.jsx(R,{size:S?48:84,title:u,isMyAvatar:!0,isPremium:k.isPremium(),avatar:(t==null?void 0:t.avatar)??void 0,rating:t==null?void 0:t.rating,disabled:!0}),e.jsx(g,{direction:"column",gap:"xs",m:"xs",justify:"space-between",children:e.jsx(g,{direction:"column",children:e.jsxs(e.Fragment,{children:[u,e.jsxs(g,{wrap:"nowrap",align:"baseline",gap:4,children:[e.jsx("h4",{children:t==null?void 0:t.rating}),e.jsx(z,{size:12})]})]})})})]})},Z=c=>{const{isSearchStarted:s}=c;return e.jsx(y,{justify:"center",children:!s&&e.jsx(B,{size:16,type:"dots"})})},$=c=>{const{onChange:s,disabled:l}=c,t=r(i=>i.config.searchOnlyByRatingEnabled),d=h(i=>i.config.setSearchOnlyByRating);return e.jsx(q,{checked:t,disabled:l,size:"md",label:e.jsx(C,{component:"div",size:"md",children:p("searchByRating")}),labelPosition:"left",styles:()=>({label:{paddingLeft:5},body:{alignItems:"center"}}),onChange:i=>{d(i.target.checked),s&&s(i.target.checked),I.trackSwitchActiveSearchMode(t)}})},O=(c,s)=>{const l=f.useMemo(()=>s,[]);f.useEffect(()=>{l.some((t,d)=>t!==s[d])&&c()},s)},X=c=>{const{gameSettingsOptions:s}=c,l=r(m=>m.online.gameModeVariants),t=r(m=>m.gameSettings.gameTime),d=r(m=>m.gameSettings.stepTime),i=r(m=>m.online.gameMode),S=r(m=>m.flags.maioEnabled),u=G(),n=h(m=>m.online.setGameMode),a=h(m=>m.online.updateServerAnswerForActiveSearch),o=f.useMemo(()=>K(()=>{a(!0)},300),[]);return O(()=>{o()},[]),O(()=>{o()},[t,d]),e.jsxs(N,{justify:"center",gap:"xs",children:[(!Q||S)&&e.jsx(e.Fragment,{children:T().feature[w.OnlineGameFullTimeControlEnabled]?e.jsx(J,{id:x.modal.friendGame.gameSettings,turnHidden:!0,changeTimeMode:!0,withOutTurnOffTime:!0,betSettings:!0,options:e.jsx(g,{pt:"0.25rem",wrap:"wrap",align:"center",children:s&&s(!0,u,o)})}):e.jsxs(e.Fragment,{children:[e.jsx(C,{component:"div",size:"md",color:u?"#5c5f66":void 0,children:p("timeControl")}),e.jsx(D,{data:l,disabled:u,value:i,onChange:m=>{n(m),o()}})]})}),!S&&e.jsx($,{onChange:o,disabled:u})]})},ee=({id:c,closeModal:s,gameSettingsOptions:l,isSearchStarted:t})=>e.jsxs(g,{direction:"column",gap:"md",children:[e.jsx(Y,{isSearchStarted:t}),e.jsx(X,{gameSettingsOptions:l}),e.jsx(W,{isSearchStarted:t}),e.jsx(Z,{isSearchStarted:t,closeModal:s,id:c})]}),te=c=>{const{gameSettingsOptions:s}=c,{closeModal:l}=H(L.OnlineGameStatusModal),t=r(o=>o.online.onlineState),d=h(o=>o.online.setOfflineState),i=r(o=>o.config.windowSize.windowWidth<=500),S=V(),u=h(o=>o.session.setPassiveSearchDisabled),n=r(o=>o.flags.isScreenshotTest||o.online.onlineState>b.PASSIVE_SEARCH&&o.online.onlineState<b.GAME_PLAY),a=f.useCallback(()=>{u(!0),d({reason:"stop_search_game"}),l()},[t]);return T().feature[w.Online]?e.jsx(U,{id:x.modal.onlineGameStatus.index,idCloseButton:x.modal.onlineGameStatus.closeButton,fullScreen:i&&S,visible:!0,onClose:n?a:()=>{},title:p("playOnline"),titleCentered:!0,autoSize:!1,children:e.jsx(y,{justify:"center",w:"100%",children:e.jsx(g,{direction:"column",w:"100%",children:e.jsx(ee,{isSearchStarted:n,id:x.modal.onlineGameStatus.searchOpponent,closeModal:a,gameSettingsOptions:s})})})}):null},ge=_.memo(te);export{ge as default};
